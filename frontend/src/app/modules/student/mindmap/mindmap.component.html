<app-header></app-header>
<div class="mindmap-container">
  <div class="page-header">
    <h1>Mind Map Helper</h1>
    <p>Upload your syllabus PDF to generate an interactive mind map with study resources</p>
  </div>

  <!-- Upload Section -->
  <div class="upload-section card">
    <div class="card-header">
      <h3>ğŸ“„ Upload Syllabus PDF</h3>
      <p>Convert your syllabus into an organized mind map with linked study materials</p>
    </div>
    
    <div class="upload-area">
      <div class="file-input-wrapper">
        <input 
          type="file" 
          id="pdfFile"
          accept=".pdf" 
          (change)="onFileSelected($event)"
          [disabled]="uploading"
          #fileInput
        >
        <label for="pdfFile" class="file-label" [class.disabled]="uploading">
          <span class="upload-icon">ğŸ“</span>
          <span class="upload-text">
            {{ fileName || 'Choose PDF file or drag here' }}
          </span>
          <span class="file-hint">Maximum file size: 10MB</span>
        </label>
      </div>

      <div class="selected-file" *ngIf="selectedFile && !uploading">
        <div class="file-info">
          <span class="file-icon">ğŸ“„</span>
          <span class="file-name">{{ fileName }}</span>
          <span class="file-size">{{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB</span>
        </div>
        <button class="clear-btn" (click)="clearSelection()">âœ•</button>
      </div>

      <div class="upload-progress" *ngIf="uploading">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="uploadProgress"></div>
        </div>
        <p class="progress-text">{{ uploadProgress }}% - Analyzing PDF and generating mind map...</p>
      </div>

      <button 
        class="btn btn-primary btn-upload" 
        (click)="uploadSyllabus()" 
        [disabled]="!selectedFile || uploading"
      >
        <span *ngIf="!uploading">ğŸš€ Generate Mind Map</span>
        <span *ngIf="uploading">â³ Processing...</span>
      </button>

      <div *ngIf="error" class="error-message">
        <span class="error-icon">âš ï¸</span>
        {{ error }}
      </div>
    </div>
  </div>

  <!-- Mind Map Display -->
  <div *ngIf="mindMapData && rootNode" class="mindmap-display card">
    <div class="card-header">
      <h3>ğŸ—ºï¸ Interactive Mind Map</h3>
      <button class="btn-close" (click)="clearMindMap()">âœ•</button>
    </div>
    
    <div class="mindmap-content">
      <!-- Interactive Tree View -->
      <div class="tree-container">
        <div class="tree-instructions">
          <span class="info-icon">ğŸ’¡</span>
          <span>Click on any node to expand/collapse its children</span>
        </div>

        <!-- Root Node -->
        <div class="tree-view">
          <div class="tree-node root-node" 
               [class.expanded]="isExpanded(rootNode)"
               (click)="toggleNode(rootNode)">
            <div class="node-content">
              <span class="node-icon">{{ getNodeIcon(rootNode) }}</span>
              <div class="node-info">
                <h4 class="node-title">{{ rootNode.name }}</h4>
                <p class="node-description" *ngIf="rootNode.description">{{ rootNode.description }}</p>
              </div>
              <span class="expand-icon" *ngIf="hasChildren(rootNode)">
                {{ isExpanded(rootNode) ? 'â–¼' : 'â–¶' }}
              </span>
            </div>
          </div>

          <!-- Child Nodes (Topics) -->
          <div class="tree-children" *ngIf="isExpanded(rootNode) && rootNode.children">
            <div *ngFor="let topic of rootNode.children" class="tree-branch">
              <div class="tree-node topic-node"
                   [class.expanded]="isExpanded(topic)"
                   [class.has-children]="hasChildren(topic)"
                   (click)="toggleNode(topic); $event.stopPropagation()">
                <div class="node-content">
                  <span class="node-icon">{{ getNodeIcon(topic) }}</span>
                  <div class="node-info">
                    <h5 class="node-title">{{ topic.name }}</h5>
                    <p class="node-description" *ngIf="topic.description">{{ topic.description }}</p>
                  </div>
                  <span class="expand-icon" *ngIf="hasChildren(topic)">
                    {{ isExpanded(topic) ? 'â–¼' : 'â–¶' }}
                  </span>
                </div>
              </div>

              <!-- Subtopics -->
              <div class="tree-children subtopics" *ngIf="isExpanded(topic) && topic.children">
                <div *ngFor="let subtopic of topic.children" class="tree-node subtopic-node">
                  <div class="node-content">
                    <span class="node-icon">{{ getNodeIcon(subtopic) }}</span>
                    <div class="node-info">
                      <span class="node-title">{{ subtopic.name }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Study Resources -->
      <div class="resources-section" *ngIf="mindMapData.resources && mindMapData.resources.length > 0">
        <h4>ğŸ”— Study Resources</h4>
        <div class="resources-grid">
          <div *ngFor="let resource of mindMapData.resources" class="resource-card">
            <h5>{{ resource.topic }}</h5>
            <div class="resource-links">
              <a *ngFor="let link of resource.links" 
                 [href]="link.url" 
                 target="_blank"
                 class="resource-link"
                 [class]="'type-' + link.type">
                <span class="link-icon">
                  {{ link.type === 'video' ? 'ğŸ¥' : link.type === 'article' ? 'ğŸ“„' : link.type === 'tutorial' ? 'ğŸ“–' : 'ğŸ”—' }}
                </span>
                <span class="link-text">{{ link.title }}</span>
                <span class="external-icon">â†—</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Concepts -->
      <div class="concepts-section" *ngIf="mindMapData.key_concepts && mindMapData.key_concepts.length > 0">
        <h4>ğŸ’¡ Key Concepts</h4>
        <div class="concepts-grid">
          <div *ngFor="let concept of mindMapData.key_concepts" class="concept-card">
            <h5>{{ concept.name }}</h5>
            <p>{{ concept.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Saved Mind Maps -->
  <div class="saved-mindmaps card">
    <div class="card-header">
      <h3>ğŸ“‚ Your Saved Mind Maps</h3>
      <span class="count-badge">{{ savedMindMaps.length }}</span>
    </div>
    
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Loading your mind maps...</p>
    </div>

    <div *ngIf="!loading && savedMindMaps.length === 0" class="empty-state">
      <div class="empty-icon">ğŸ—ºï¸</div>
      <h4>No Mind Maps Yet</h4>
      <p>Upload a syllabus PDF to create your first mind map!</p>
    </div>

    <div class="mindmap-grid" *ngIf="!loading && savedMindMaps.length > 0">
      <div *ngFor="let map of savedMindMaps" class="mindmap-card" (click)="viewMindMap(map)">
        <div class="map-icon">ğŸ“„</div>
        <div class="map-info">
          <h4>{{ map.course_name || map.title || 'Untitled' }}</h4>
          <p class="map-date">
            <span class="date-icon">ğŸ“…</span>
            {{ map.created_at | date:'mediumDate' }}
          </p>
          <p class="map-topics" *ngIf="map.topic_count">
            <span class="topics-icon">ğŸ“š</span>
            {{ map.topic_count }} topics
          </p>
        </div>
        <button class="view-btn">View â†’</button>
      </div>
    </div>
  </div>
</div>
