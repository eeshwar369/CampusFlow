<app-header></app-header>

<div class="seating-chart-container">
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1>ğŸ“Š Seating Chart</h1>
        <p>Room-wise seating allocation for the exam</p>
      </div>
      <button class="btn btn-secondary" (click)="goBack()">
        â† Back to Dashboard
      </button>
    </div>
  </div>

  <!-- Statistics -->
  <div *ngIf="statistics" class="statistics-card card">
    <h2>ğŸ“ˆ Statistics</h2>
    
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-label">Total Allocated:</span>
        <span class="stat-value">{{ statistics.overall.total_allocated }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Rooms Used:</span>
        <span class="stat-value">{{ statistics.overall.rooms_used }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Unique Students:</span>
        <span class="stat-value">{{ statistics.overall.unique_students }}</span>
      </div>
    </div>
  </div>

  <!-- Filters and Actions -->
  <div class="filters-card card">
    <div class="filters-row">
      <div class="filter-group">
        <label>Search Student:</label>
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          placeholder="Roll number or name..."
          class="search-input">
      </div>

      <div class="filter-group">
        <label>Filter by Room:</label>
        <select [(ngModel)]="selectedRoom" class="room-select">
          <option [ngValue]="null">All Rooms</option>
          <option *ngFor="let room of getRoomNames()" [ngValue]="room">
            {{ room }}
          </option>
        </select>
      </div>

      <div class="filter-actions">
        <button class="btn btn-secondary" (click)="clearFilters()">
          Clear Filters
        </button>
        <button class="btn btn-primary" (click)="exportChart()">
          ğŸ“¥ Export CSV
        </button>
        <button class="btn btn-primary" (click)="printChart()">
          ğŸ–¨ï¸ Print
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading seating chart...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && (!chart || !chart.rooms || chart.rooms.length === 0)" class="empty-state card">
    <div class="empty-icon">ğŸª‘</div>
    <h3>No Seating Allocation Found</h3>
    <p>Please allocate seats for this exam first</p>
    <button class="btn btn-primary" (click)="router.navigate(['/seating-manager/allocate'])">
      Go to Seat Allocation
    </button>
  </div>

  <!-- Seating Chart -->
  <div *ngIf="!loading && chart && chart.rooms && chart.rooms.length > 0" class="chart-content">
    <div *ngFor="let room of filterRooms()" class="room-card card">
      <div class="room-header">
        <div class="room-info">
          <h2>{{ room.room_name }}</h2>
          <p class="room-details">
            <span class="detail-item">
              <span class="icon">ğŸ¢</span>
              Building: {{ room.building }}
            </span>
            <span class="detail-item">
              <span class="icon">ğŸ“</span>
              Floor: {{ room.floor }}
            </span>
            <span class="detail-item">
              <span class="icon">ğŸª‘</span>
              Capacity: {{ room.capacity }}
            </span>
            <span class="detail-item">
              <span class="icon">ğŸ‘¥</span>
              Allocated: {{ room.allocated }}
            </span>
          </p>
        </div>
        <div class="room-utilization">
          <span class="utilization-label">Utilization:</span>
          <span class="utilization-value">
            {{ ((room.allocated / room.capacity) * 100).toFixed(1) }}%
          </span>
        </div>
      </div>

      <div class="students-table">
        <table>
          <thead>
            <tr>
              <th>Seat Number</th>
              <th>Roll Number</th>
              <th>Student Name</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let student of room.students">
              <td><strong>{{ student.seat_number }}</strong></td>
              <td><code>{{ student.roll_number }}</code></td>
              <td>{{ student.name }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Summary -->
    <div class="summary-card card">
      <h2>ğŸ“‹ Summary</h2>
      <div class="summary-content">
        <p><strong>Total Rooms:</strong> {{ chart.totalRooms }}</p>
        <p><strong>Total Students Allocated:</strong> {{ chart.totalAllocated }}</p>
        <p><strong>Average per Room:</strong> {{ (chart.totalAllocated / chart.totalRooms).toFixed(1) }}</p>
      </div>
    </div>
  </div>
</div>
